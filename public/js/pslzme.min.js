const queryParamsSet=()=>{const queryParams=new URLSearchParams(window.location.search);if(!checkParams(queryParams))return{isSet:false,params:{}};if(queryParams.has("plszme-follow")){return{isSet:true,params:{acceptionParam:queryParams.get("plszme-follow"),linkCreator:queryParams.get("q1")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q1")),title:queryParams.get("q2")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q2")),firstname:queryParams.get("q3")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q3")),lastname:queryParams.get("q4")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q4")),company:queryParams.get("q5")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q5")),gender:queryParams.get("q6")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q6")),position:queryParams.get("q7")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q7")),curl:queryParams.get("q8")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q8")),fc:queryParams.get("q9")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q9")),timestamp:queryParams.get("q10"),companyGender:queryParams.get("q11")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q11")),address:queryParams.get("q12")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q12")),housenumber:queryParams.get("q13")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q13")),postcode:queryParams.get("q14")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q14")),place:queryParams.get("q15")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q15")),country:queryParams.get("q16")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q16"))}}}else{return{isSet:true,params:{linkCreator:queryParams.get("q1")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q1")),title:queryParams.get("q2")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q2")),firstname:queryParams.get("q3")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q3")),lastname:queryParams.get("q4")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q4")),company:queryParams.get("q5")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q5")),gender:queryParams.get("q6")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q6")),position:queryParams.get("q7")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q7")),curl:queryParams.get("q8")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q8")),fc:queryParams.get("q9")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q9")),timestamp:queryParams.get("q10"),companyGender:queryParams.get("q11")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q11")),address:queryParams.get("q12")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q12")),housenumber:queryParams.get("q13")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q13")),postcode:queryParams.get("q14")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q14")),place:queryParams.get("q15")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q15")),country:queryParams.get("q16")===null?encodeURIComponent(""):encodeURIComponent(queryParams.get("q16"))}}}};function checkParams(queryParams){if(queryParams.has("q1")&&queryParams.has("q2")&&queryParams.has("q3")&&queryParams.has("q4")&&queryParams.has("q5")&&queryParams.has("q6")&&queryParams.has("q7")&&queryParams.has("q8")&&queryParams.has("q9")&&queryParams.has("q10")){return true}else{return false}}function getCookie(name){let cookie={};document.cookie.split(";").forEach(function(el){let split=el.split("=");cookie[split[0].trim()]=split.slice(1).join("=")});return cookie[name]}function handleAPIRequest(requestObject){console.log(requestObject);return new Promise(function(resolve,reject){try{fetch(pslzmeData.rest_url,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":pslzmeData.nonce},body:JSON.stringify(requestObject)}).then(response=>{if(!response.ok){throw new Error("Network response was not ok: "+response.status)}return response.json()}).then(data=>resolve(data)).catch(error=>{console.error("Action failed:",requestObject.request,error);reject(error)})}catch(error){console.error("Unexpected error:",error);reject(error)}})}function pslzmeRedirection(){const noPslzmeCookiebannerPages=["pslzme-decline.html"];const currentLocation=window.location.pathname;if(!noPslzmeCookiebannerPages.includes(currentLocation)){const userCameFromPslzmeLink=queryParamsSet();if(userCameFromPslzmeLink.isSet===true){const actualTargetPage=window.location.pathname.replace("/","");checkQueryIsLocked(userCameFromPslzmeLink).then(queryLocked=>{if(queryLocked){handleRedirectionToLockedPage(actualTargetPage);return}else{handleRedirectionToAcceptionPage(userCameFromPslzmeLink,actualTargetPage);return}})}}}function handleRedirectionToLockedPage(actualTargetPage){window.location.href=window.location.origin+"/pslzme-decline.html?pslzme-follow="+actualTargetPage;return}function handleRedirectionToAcceptionPage(userCameFromPslzmeLink,actualTargetPage){if(!userCameFromPslzmeLink.isSet)return;const consentCookie=getCookie("consent_cookie");let consentCookieAccepted=false;if(consentCookie){try{const decodedCookie=JSON.parse(consentCookie);consentCookieAccepted=decodedCookie.queryTime===userCameFromPslzmeLink.params.timestamp}catch(e){console.warn("Invalid consent cookie, ignoring.")}}if(window.location.href.startsWith(pslzmeData.accept_url))return;if(!consentCookieAccepted&&!userCameFromPslzmeLink.params.hasOwnProperty("acceptionParam")){const queryParamsString=window.location.search.substring(1);const redirectUrl=pslzmeData.accept_url+"?pslzme-follow="+encodeURIComponent(actualTargetPage)+(queryParamsString?"&"+queryParamsString:"");window.location.href=redirectUrl}}function checkQueryIsLocked(urlParams){const requestData={timestamp:urlParams.params.timestamp};const requestObject={data:JSON.stringify(requestData),request:"query-lock-check"};return new Promise(function(resolve){handleAPIRequest(requestObject).then(response=>{resolve(response.queryIsLocked)})})}function pslzmeQueryClickListener(){const queryParams=queryParamsSet();if(queryParams.isSet===true){document.addEventListener("click",function(event){const eventTarget=event.target;if(eventTarget.classList.contains("pslzme-cookiebar-close-btn"))return;if(eventTarget.tagName==="A"||eventTarget.tagName==="IMG"||eventTarget.tagName==="CANVAS"||eventTarget.tagName==="BUTTON"){const linkElement=eventTarget.closest("a");if(linkElement&&linkElement.target==="_blank"){return}event.preventDefault();if(isSameDomain(linkElement.href)){window.location.href=linkElement.href+"?q1="+queryParams.params.linkCreator+"&q2="+queryParams.params.title+"&q3="+queryParams.params.firstname+"&q4="+queryParams.params.lastname+"&q5="+queryParams.params.company+"&q6="+queryParams.params.gender+"&q7="+queryParams.params.position+"&q8="+queryParams.params.curl+"&q9="+queryParams.params.fc+"&q10="+queryParams.params.timestamp+"&q11="+queryParams.params.companyGender+"&q12="+queryParams.params.address+"&q13="+queryParams.params.housenumber+"&q14="+queryParams.params.postcode+"&q15="+queryParams.params.place+"&q16="+queryParams.params.country}else{event.target.removeEventListener("click",arguments.callee)}}})}}function isSameDomain(url){const currentDomain=window.location.hostname;const clickedDomain=new URL(url).hostname;return currentDomain===clickedDomain}function controlPslzmeCookiebar(){const queryParamsAreSet=queryParamsSet();if(queryParamsAreSet.isSet===true){const consentCookie=getCookie("consent_cookie");if(consentCookie!==undefined){switchCloseBtnVisibility(true)}else{switchCloseBtnVisibility(false)}if(queryParamsAreSet.isSet===true&&queryParamsAreSet.params.hasOwnProperty("acceptionParam")){checkConsent(queryParamsAreSet,consentCookie)}}}function checkConsent(queryParams,consentCookie){if(consentCookie===undefined){showVisibility()}if(consentCookie!==undefined){const cookiesDiffer=compareUpdatedQueryTimestampWithCookie(consentCookie,queryParams);if(cookiesDiffer){document.cookie="consent_cookie"+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";showVisibility()}}}function compareUpdatedQueryTimestampWithCookie(alreadySetConsentCookie,queryParams){const decodedCookie=JSON.parse(alreadySetConsentCookie);if(decodedCookie.queryTime!==queryParams.params.timestamp){return true}else{return false}}function switchCloseBtnVisibility(cookieIsSet){const closeBtn=document.querySelector(".pslzme-cookiebar-close-btn");if(!closeBtn)return;if(cookieIsSet===false){closeBtn.style.display="none"}else{closeBtn.style.display="inline-block"}}function showVisibility(){const cookiebar=document.getElementById("pslzme-cookiebar");cookiebar.style.display="flex";cookiebar.style.justifyContent="center";cookiebar.style.alignItems="center"}function hideVisibility(){const cookiebar=document.getElementById("pslzme-cookiebar");cookiebar.style.display="none"}function saveConsentCookie(cookieAccepted){const queryAttributes=queryParamsSet();const queryTimestamp=queryAttributes.params.timestamp;const cookieValue={accepted:cookieAccepted,queryTime:queryTimestamp};var expirationDate=new Date;expirationDate.setTime(expirationDate.getTime()+1*60*60*1e3);var expires="expires="+expirationDate.toUTCString();document.cookie="consent_cookie="+JSON.stringify(cookieValue)+";"+expires+";secure;sameSite=Lax"}const addVisibleClassesToPslzmeElement=element=>{element.style.visibility="visible";element.classList.remove("pslzme-slide-out-right");element.classList.add("pslzme-slide-in-right")};const addHiddenClassesToPslzmeElement=element=>{element.classList.remove("pslzme-slide-in-right");element.classList.add("pslzme-slide-out-right")};const addCookieCallerClickListener=()=>{const $caller=$("#pslzme-cookie-caller");if(!$caller||$caller.length===0)return;$caller.click(function(){$("#pslzme-cookiebar").css({display:"flex","align-items":"center","justify-content":"center"})})};const controlPslzmeCookieCaller=()=>{let html=document.querySelector("html");const pslzmeCookieCaller=document.getElementById("pslzme-cookie-caller");const queriesAreSet=queryParamsSet();addCookieCallerClickListener();window.addEventListener("scroll",function(event){if(html.scrollTop>=110){if(queriesAreSet.isSet===true){addVisibleClassesToPslzmeElement(pslzmeCookieCaller)}}else if(html.scrollTop<=110){if(queriesAreSet.isSet===true){addHiddenClassesToPslzmeElement(pslzmeCookieCaller)}}})};function verifyNameAndGreeting(){const queryData=queryParamsSet();if(queryData.isSet===true){handleGreetingVerification(queryData.params);handleCustomerNameVerification(queryData.params)}}async function handleGreetingVerification(queryData){const requestData={firstContact:queryData.fc,linkCreator:queryData.linkCreator,timestamp:queryData.timestamp};const requestObject={data:JSON.stringify(requestData),request:"extract-greeting-data"};await extractGreetingDataRequest(requestObject)}function handleCustomerNameVerification(queryData){const inputs=document.querySelectorAll("#name-verifiyer input");inputs.forEach((input,index)=>{input.addEventListener("input",function(){if(input.value.length===1){if(index===inputs.length-1){inputs[index].blur()}else{inputs[index+1].focus()}}});input.addEventListener("change",function(){compareName(queryData)})})}async function extractGreetingDataRequest(requestObject){handleAPIRequest(requestObject).then(response=>{const firstContactSpan=document.getElementById("pslzme-cookiebar-first-contact");const linkCreatorSpan=document.getElementById("pslzme-cookiebar-link-creator");firstContactSpan.innerText=response.decryptedFirstContact;linkCreatorSpan.innerText=response.decryptedLinkCreator})}async function compareName(queryData){const firstInput=$("#name-verifiyer input:eq(0)");const secondInput=$("#name-verifiyer input:eq(1)");const thirdInput=$("#name-verifiyer input:eq(2)");const acceptBtn=$("#pslzme-cookiebar-accept-btn");if(!checkEmptyInput(firstInput[0].value)||!checkEmptyInput(secondInput[0].value)||!checkEmptyInput(thirdInput[0].value)){switchInputClasses(firstInput,"success","error");switchInputClasses(secondInput,"success","error");switchInputClasses(thirdInput,"success","error");acceptBtn.prop("disabled",true);acceptBtn.focus();return}const requestData={firstInput:firstInput.val().toLowerCase(),secondInput:secondInput.val().toLowerCase(),thirdInput:thirdInput.val().toLowerCase(),encryptedLastName:queryData.lastname,timestamp:queryData.timestamp};const requestObject={data:JSON.stringify(requestData),request:"compare-link-owner"};await compareLinkOwnerRequest(requestObject,firstInput,secondInput,thirdInput,acceptBtn)}async function compareLinkOwnerRequest(requestObject,firstInput,secondInput,thirdInput,acceptBtn){handleAPIRequest(requestObject).then(response=>{if(response.nameMatchesOwner===true){handleNameMatchesOwner(firstInput,secondInput,thirdInput,acceptBtn)}else{handleNameDoesntMatchOwner(firstInput,secondInput,thirdInput,acceptBtn)}})}function handleNameMatchesOwner(firstInput,secondInput,thirdInput,acceptBtn){switchInputClasses(firstInput,"error","success");switchInputClasses(secondInput,"error","success");switchInputClasses(thirdInput,"error","success");acceptBtn.prop("disabled",false);document.addEventListener("keydown",handleEnterEventListener);return}function handleNameDoesntMatchOwner(firstInput,secondInput,thirdInput,acceptBtn){switchInputClasses(firstInput,"success","error");switchInputClasses(secondInput,"success","error");switchInputClasses(thirdInput,"success","error");document.removeEventListener("keydown",handleEnterEventListener);acceptBtn.prop("disabled",true);firstInput[0].value="";secondInput[0].value="";thirdInput[0].value="";firstInput.focus();const nameVerifyer=$("#name-verifiyer")[0];const remainingAttempts=$("#remaining-attempts")[0];let userAttempts=parseInt(nameVerifyer.dataset.userAttempts);userAttempts++;nameVerifyer.dataset.userAttempts=userAttempts;if(userAttempts===3){handleCookie(false,true);hideVisibility()}remainingAttempts.innerText=3-userAttempts;return}function handleEnterEventListener(event){if(event.key==="Enter"||event.keyCode===13){saveConsentCookie(true);handleCookie(true);hideVisibility()}}function switchInputClasses(element,oldClass,newClass){element.removeClass(oldClass);element.addClass(newClass)}function checkEmptyInput(inputVal){return inputVal!==""}function handleCookie(accepted,queryLocked=false){const firstInput=$("#name-verifiyer input:eq(0)");const secondInput=$("#name-verifiyer input:eq(1)");const thirdInput=$("#name-verifiyer input:eq(2)");firstInput.value="";secondInput.value="";thirdInput.value="";const urlParams=queryParamsSet();if(urlParams!==undefined){if(urlParams.isSet===true){let convertedCookieAccepted=0;let convertedQueryLocked=0;if(accepted){convertedCookieAccepted=1}if(queryLocked){convertedQueryLocked=1}const requestData={linkCreator:decodeURIComponent(urlParams.params.linkCreator).replaceAll(" ","+"),title:decodeURIComponent(urlParams.params.title).replaceAll(" ","+"),firstname:decodeURIComponent(urlParams.params.firstname).replaceAll(" ","+"),lastname:decodeURIComponent(urlParams.params.lastname).replaceAll(" ","+"),company:decodeURIComponent(urlParams.params.company).replaceAll(" ","+"),companyGender:decodeURIComponent(urlParams.params.companyGender).replaceAll(" ","+"),gender:decodeURIComponent(urlParams.params.gender).replaceAll(" ","+"),address:decodeURIComponent(urlParams.params.address).replaceAll(" ","+"),housenumber:decodeURIComponent(urlParams.params.housenumber).replaceAll(" ","+"),postcode:decodeURIComponent(urlParams.params.postcode).replaceAll(" ","+"),place:decodeURIComponent(urlParams.params.place).replaceAll(" ","+"),country:decodeURIComponent(urlParams.params.country).replaceAll(" ","+"),position:decodeURIComponent(urlParams.params.position).replaceAll(" ","+"),curl:decodeURIComponent(urlParams.params.curl).replaceAll(" ","+"),fc:decodeURIComponent(urlParams.params.fc).replaceAll(" ","+"),timestamp:urlParams.params.timestamp,cookieAccepted:convertedCookieAccepted,queryIsLocked:convertedQueryLocked};const requestObject={data:JSON.stringify(requestData),request:"query-acception"};handleAPIRequest(requestObject).then(()=>{const noQueryFollowPage=urlParams.params.acceptionParam;if(accepted===false){handleCookieDeclined(noQueryFollowPage)}else if(accepted===true){handleCookieAccepted(noQueryFollowPage,requestData)}})}}}function handleCookieDeclined(noQueryFollowPage){document.cookie="consent_cookie"+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";if(noQueryFollowPage===null||noQueryFollowPage===undefined){window.location.href=window.location.origin+window.location.pathname}else{window.location.href=window.location.origin+"/"+noQueryFollowPage}}function handleCookieAccepted(noQueryFollowPage,requestData){const paramQuery="?q1="+requestData.linkCreator+"&q2="+requestData.title+"&q3="+requestData.firstname+"&q4="+requestData.lastname+"&q5="+requestData.company+"&q6="+requestData.gender+"&q7="+requestData.position+"&q8="+requestData.curl+"&q9="+requestData.fc+"&q10="+requestData.timestamp+"&q11="+requestData.companyGender+"&q12="+requestData.address+"&q13="+requestData.housenumber+"&q14="+requestData.postcode+"&q15="+requestData.place+"&q16="+requestData.country;if(noQueryFollowPage===null||noQueryFollowPage===undefined){window.location.href=window.location.origin+window.location.pathname+paramQuery}else{window.location.href=window.location.origin+"/"+noQueryFollowPage+paramQuery}}document.addEventListener("DOMContentLoaded",function(){(function($){pslzmeRedirection()})(jQuery)});